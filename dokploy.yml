# Dokploy configuration file
# This file contains the configuration for deploying the mobile backend on Dokploy

name: mobile-backend
description: "Production-ready Go mobile backend with PostgreSQL, Redis, and monitoring"
version: "1.0.0"

# Environment variables that need to be set in Dokploy
environment:
  # Database Configuration
  DATABASE_URL: "postgres://appuser:${POSTGRES_PASSWORD}@postgres:5432/appdb?sslmode=disable"
  POSTGRES_DB: "appdb"
  POSTGRES_USER: "appuser"
  POSTGRES_PASSWORD: "REQUIRED" # This must be set in Dokploy UI

  # Redis Configuration
  REDIS_URL: "redis://redis:6379"

  # JWT Configuration
  JWT_SECRET: "REQUIRED" # This must be set in Dokploy UI

  # Server Configuration
  GIN_MODE: "release"
  LOG_LEVEL: "info"

  # CORS Configuration
  CORS_ALLOWED_ORIGINS: "*" # Configure for your frontend domains

  # Grafana Configuration
  GRAFANA_ADMIN_PASSWORD: "admin" # Change this in production

# Ports to expose
ports:
  - "8080:8080" # Main API
  - "3000:3000" # Grafana (optional)
  - "9090:9090" # Prometheus (optional)

# Health check configuration
healthcheck:
  path: "/health"
  port: 8080
  interval: 30s
  timeout: 10s
  retries: 3

# Resource limits
resources:
  memory: "512Mi"
  cpu: "500m"

# Restart policy
restart: unless-stopped

# Network configuration
network: mobile-backend-network

# Volume mounts
volumes:
  - "uploads_data:/app/uploads"
  - "logs_data:/app/logs"
  - "postgres_data:/var/lib/postgresql/data"
  - "redis_data:/data"
  - "prometheus_data:/prometheus"
  - "grafana_data:/var/lib/grafana"
